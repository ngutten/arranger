
Connecting to '/tmp/audio_server.sock' ...
Connected.


============================================================
  Checkpoint 1: Server alive
============================================================
  [[32mPASS[0m] ping responds ok  ({'features': ['fluidsynth', 'sine', 'mixer', 'control_source', 'track_source', 'note_on', 'note_off', 'all_notes_off', 'set_node_config'], 'status': 'ok', 'version': '0.1.0'})
  [[36mINFO[0m] features: ['fluidsynth', 'sine', 'mixer', 'control_source', 'track_source', 'note_on', 'note_off', 'all_notes_off', 'set_node_config']
  [[32mPASS[0m] builtin.note_gate registered  (['builtin.sine', 'builtin.note_gate', 'builtin.control_source', 'builtin.control_monitor', 'builtin.mixer', 'builtin.reverb', 'builtin.arpeggiator', 'builtin.fluidsynth', 'builtin.sine', 'builtin.note_gate', 'builtin.control_source', 'builtin.control_monitor', 'builtin.mixer', 'builtin.reverb', 'builtin.arpeggiator', 'builtin.fluidsynth'])
  [[32mPASS[0m] builtin.control_monitor registered

============================================================
  Checkpoint 2: Graph load
============================================================
  [[32mPASS[0m] set_graph succeeds
  [[36mINFO[0m] Graph: track_source â†’ note_gate â†’ ctrl_mon + sine â†’ mixer

============================================================
  Checkpoint 3: Baseline (no notes)
============================================================
  [[32mPASS[0m] get_node_data succeeds
  [[36mINFO[0m] History length: 20
  [[32mPASS[0m] All values are 0 before any notes  (min=0.0000 max=0.0000 mean=0.0000 nonzero=0/20)

============================================================
  Checkpoint 4â€“6: note_on via track_source fan-out
============================================================
  [[32mPASS[0m] Graph reload ok
  [[36mINFO[0m] Injecting note_on(ch=0, pitch=60, vel=100) â†’ track_1
  [[32mPASS[0m] note_on command accepted  ({'status': 'ok'})
  [[36mINFO[0m] After note_on: 37 samples, min=0.0000 max=0.0000 mean=0.0000 nonzero=0
  [[32mPASS[0m] History has entries after note_on  (got 37 entries)
  [[31mFAIL[0m] Control output is non-zero (gate mode = 1.0)  (max=0.0000 (expected ~1.0 in gate mode))
  [[36mINFO[0m] Injecting note_off(ch=0, pitch=60) â†’ track_1
  [[32mPASS[0m] note_off command accepted  ({'status': 'ok'})
  [[36mINFO[0m] After note_off (last 20 samples): min=0.0000 max=0.0000 nonzero=0
  [[32mPASS[0m] Control output returns to 0 after note_off  (last 20 samples max=0.0000)

============================================================
  Checkpoint 9: note_on via scheduler targeting note_gate directly
============================================================
  [[36mINFO[0m] Scheduler calls node->note_on() directly, bypassing track_source fan-out
  [[36mINFO[0m] (preview_note_on only works for TrackSourceNodes, so we use set_schedule here)
  [[32mPASS[0m] Direct graph load ok
  [[32mPASS[0m] set_schedule ok
  [[32mPASS[0m] render ok
  [[36mINFO[0m] Direct path: 268 samples, min=0.0000 max=0.0000 nonzero=0
  [[31mFAIL[0m] Non-zero output with direct scheduler path  (max=0.0000)

  [[36mINFO[0m] Checkpoint 9 vs Checkpoint 8 comparison:
  [[36mINFO[0m]   Both use offline render; the difference is whether events go
  [[36mINFO[0m]   through track_source fan-out (8) or directly to note_gate (9).
  [[36mINFO[0m]   If 9 passes but 8 fails â†’ set_downstream not including note_gate
  [[36mINFO[0m]     (check MIDI connection port names in graph JSON).
  [[36mINFO[0m]   If both fail â†’ control signal isn't flowing from note_gate â†’ ctrl_mon

============================================================
  Checkpoint 10: Velocity mode (mode=1)
============================================================
  [[32mPASS[0m] Graph reload ok
  [[32mPASS[0m] set_param mode=1 accepted  ({'status': 'ok'})
  [[31mFAIL[0m] velocity=64 â†’ outputâ‰ˆ0.504  (got max=0.0000 in last 10 samples)
  [[31mFAIL[0m] velocity=127 â†’ outputâ‰ˆ1.000  (got max=0.0000 in last 10 samples)
  [[31mFAIL[0m] velocity=32 â†’ outputâ‰ˆ0.252  (got max=0.0000 in last 10 samples)

============================================================
  Checkpoint 8: Offline render via scheduler
============================================================
  [[36mINFO[0m] Uses set_schedule + render to check control output in a deterministic way
  [[32mPASS[0m] Graph load ok
  [[32mPASS[0m] set_schedule ok
  [[32mPASS[0m] render ok
  [[36mINFO[0m] Post-render history: 180 samples, min=0.0000 max=0.0000 mean=0.0000 nonzero=0
  [[31mFAIL[0m] Control output was non-zero during render  (0/180 non-zero samples)
  [[31mFAIL[0m] Peak was ~1.0 (gate mode)  (max=0.0000)

============================================================
  Diagnostics complete.
============================================================

Interpretation guide:
  Checkpoint 3 fails (history empty):
    â†’ Graph may not be processing. Check server logs.

  Checkpoint 4-5 fails (no non-zero after note_on via track_source):
    â†’ Either (a) TrackSourceNode not forwarding to NoteGate,
      or (b) NoteGate internal state updating but control not reaching monitor.

  Checkpoint 9 passes but 4-5 fails:
    â†’ Bug is in set_downstream / MIDI fan-out. TrackSourceNode isn't
      including the NoteGate in its downstream list.
      Check connections: the MIDI wire must be to_port="event_in" not
      something the graph ignores.

  Checkpoint 9 also fails:
    â†’ Control value isn't making it from NoteGate to ControlMonitor.
      Check graph.cpp control port routing (PortBuffer.control vs .audio).

  Checkpoint 8 (render) passes but real-time (4-5) fails:
    â†’ Timing issue â€” note events arrive but graph hasn't processed them
      before we poll. Try increasing wait_for_blocks(n).

